# Task-based Tool Group Configuration
# This file defines which tools are available in each task state.
#
# Format:
#   Each state has:
#   - available: List of tools that are exposed to the LLM
#   - hidden: List of tools/patterns that are hidden
#
# Patterns:
#   - Exact match: "search_memory"
#   - Wildcard prefix: "delete_*" (matches delete_memories, delete_all_memories, etc.)
#   - All: "*" (matches everything except core tools)
#
# Core tools (Read, Grep, Glob, Bash) are always available regardless of state.

version: "1.0"

# Core tools that are always available
core_tools:
  - Read
  - Grep
  - Glob
  - Bash

# Tool availability per state
states:
  INITIAL:
    description: "Before intent classification. Only core tools available."
    available:
      - Read
      - Grep
      - Glob
      - Bash
    hidden:
      - "*"  # All others hidden until intent is clear

  CODE_ANALYSIS:
    description: "Code-related tasks. Code tools visible, memory tools hidden."
    available:
      # Core tools
      - Read
      - Grep
      - Glob
      - Bash
      # Code analysis tools
      - find_callers
      - find_callees
      - explain_code
      - search_code_hybrid
      - impact_analysis
    hidden:
      # Memory tools hidden to prevent distraction
      - search_memory
      - add_memories
      - update_memory
      - list_memories
      - get_memory
      # Graph tools hidden (except code graph)
      - graph_related_memories
      - graph_entity_network
      - graph_similar_memories
      - graph_aggregate
      - graph_tag_cooccurrence
      - graph_path_between_entities
      - graph_subgraph
      - graph_normalize_entities
      - graph_normalize_entities_semantic
      - graph_entity_relations
      - graph_biography_timeline
      - graph_related_tags
      # Delete operations hidden
      - delete_*
      # Test generation hidden (use TEST_WRITE for that)
      - test_generation
      # ADR and PR hidden (use specific states)
      - adr_automation
      - pr_analysis
      # Indexing hidden
      - index_*

  MEMORY_OPS:
    description: "Memory-related tasks. Memory tools visible, code tools hidden."
    available:
      # Core tools
      - Read
      - Grep
      - Glob
      - Bash
      # Memory tools
      - search_memory
      - add_memories
      - update_memory
      - list_memories
      - get_memory
      # Graph tools for memory exploration
      - graph_related_memories
      - graph_entity_network
      - graph_similar_memories
      - graph_aggregate
      - graph_entity_relations
    hidden:
      # Code tools hidden
      - find_callers
      - find_callees
      - search_code_hybrid
      - explain_code
      - impact_analysis
      - test_generation
      - pr_analysis
      - adr_automation
      # Delete hidden
      - delete_*
      # Indexing hidden
      - index_*

  PR_REVIEW:
    description: "PR review tasks. Analysis tools visible."
    available:
      # Core tools
      - Read
      - Grep
      - Glob
      - Bash
      # PR analysis tools
      - pr_analysis
      - impact_analysis
      - search_code_hybrid
      # Memory for conventions lookup
      - search_memory
    hidden:
      # Memory write hidden
      - add_memories
      - update_memory
      # Delete hidden
      - delete_*
      # Test generation hidden
      - test_generation
      # Indexing hidden
      - index_*
      # ADR hidden
      - adr_automation

  TESTING:
    description: "Test generation tasks. Test tools visible."
    available:
      # Core tools
      - Read
      - Grep
      - Glob
      - Bash
      # Test tools
      - test_generation
      - explain_code
      - search_code_hybrid
      - find_callers
      - find_callees
    hidden:
      # Memory tools hidden
      - search_memory
      - add_memories
      - update_memory
      - list_memories
      - get_memory
      # Graph tools hidden
      - graph_*
      # Delete hidden
      - delete_*
      # PR review hidden
      - pr_analysis
      # ADR hidden
      - adr_automation

# State transitions
# Maps (current_state, intent) -> new_state
transitions:
  INITIAL:
    CODE_TRACE: CODE_ANALYSIS
    CODE_UNDERSTAND: CODE_ANALYSIS
    MEMORY_QUERY: MEMORY_OPS
    MEMORY_WRITE: MEMORY_OPS
    PR_REVIEW: PR_REVIEW
    TEST_WRITE: TESTING
    GENERAL: INITIAL  # Stay in initial

  CODE_ANALYSIS:
    MEMORY_WRITE: MEMORY_OPS  # Document findings
    CODE_TRACE: CODE_ANALYSIS
    CODE_UNDERSTAND: CODE_ANALYSIS
    TEST_WRITE: TESTING

  MEMORY_OPS:
    MEMORY_QUERY: MEMORY_OPS
    MEMORY_WRITE: MEMORY_OPS
    CODE_TRACE: CODE_ANALYSIS
    CODE_UNDERSTAND: CODE_ANALYSIS

  PR_REVIEW:
    MEMORY_WRITE: MEMORY_OPS  # Save review findings
    PR_REVIEW: PR_REVIEW
    CODE_TRACE: CODE_ANALYSIS

  TESTING:
    CODE_TRACE: CODE_ANALYSIS
    CODE_UNDERSTAND: CODE_ANALYSIS
    TEST_WRITE: TESTING
    MEMORY_WRITE: MEMORY_OPS  # Document test decisions
